<div class="modal-container">
  <div class="modal-content animate-modal">
    <button class="close-modal" (click)="closeModal()">‚úñ</button>

    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress" [style.width.%]="progressPercentage"></div>
      </div>
      <p class="progress-text">{{ progressPercentage }}% completado</p>
    </div>

    <h2 class="modal-title">Ficha del Paciente</h2>

    <form (ngSubmit)="onSubmit()" class="ficha-form" novalidate>
      <!-- Informaci√≥n Personal -->
      <div class="section">
        <h3>Informaci√≥n Personal</h3>
        <div class="input-group">
          <div class="input-item">
            <label for="nombres">Nombres</label>
            <input type="text" id="nombres" [(ngModel)]="paciente.nombres" name="nombres" (input)="updateProgress()" required />
            <div *ngIf="showRequiredError && !paciente.nombres" class="error-message">*Campo requerido</div>
          </div>

          <div class="input-item">
            <label for="apellidos">Apellidos</label>
            <input type="text" id="apellidos" [(ngModel)]="paciente.apellidos" name="apellidos" (input)="updateProgress()" required />
            <div *ngIf="showRequiredError && !paciente.apellidos" class="error-message">*Campo requerido</div>
          </div>
        </div>

        <div class="input-group">
          <div class="input-item">
            <label for="fechaNacimiento">Fecha de Nacimiento</label>
            <input type="date" id="fechaNacimiento" [(ngModel)]="paciente.fechaNacimiento" name="fechaNacimiento" (input)="updateProgress()" required />
            <div *ngIf="showRequiredError && !paciente.fechaNacimiento" class="error-message">*Campo requerido</div>
          </div>

          <div class="input-item">
            <label for="genero">G√©nero</label>
            <select id="genero" [(ngModel)]="paciente.genero" name="genero" (change)="updateProgress()" required>
              <option value="">Seleccione</option>
              <option value="Masculino">üë® Masculino</option>
              <option value="Femenino">üë© Femenino</option>
              <option value="Otro">üåà Otro</option>
            </select>
            <div *ngIf="showRequiredError && !paciente.genero" class="error-message">*Campo requerido</div>
          </div>
        </div>
      </div>

      <!-- Contacto -->
      <div class="section">
        <h3>Contacto</h3>
        <div class="input-group">
          <div class="input-item">
            <label for="correo">Correo Electr√≥nico</label>
            <input type="email" id="correo" [(ngModel)]="paciente.correo" name="correo" (input)="updateProgress()" required />
            <div *ngIf="showRequiredError && !paciente.correo" class="error-message">*Campo requerido</div>
          </div>
        </div>

        <div class="input-group">
          <div class="input-item">
            <label for="telefono">Tel√©fono</label>
            <div class="phone-input">
              <span class="flag-icon">üá®üá± +56</span>
              <input type="tel" id="telefono" [(ngModel)]="paciente.telefono" name="telefono" placeholder="Ingrese tel√©fono" (input)="updateProgress()" required />
            </div>
            <div *ngIf="showRequiredError && !paciente.telefono" class="error-message">*Campo requerido</div>
          </div>

          <div class="input-item">
            <label for="telefonoEmercia">Tel√©fono de Emergencia</label>
            <input type="tel" id="telefonoEmercia" [(ngModel)]="paciente.telefonoEmercia" name="telefonoEmercia" (input)="updateProgress()" required />
            <div *ngIf="showRequiredError && !paciente.telefonoEmercia" class="error-message">*Campo requerido</div>
          </div>
        </div>

        <div class="input-group">
          <div class="input-item">
            <label for="direccion">Direcci√≥n</label>
            <input type="text" id="direccion" [(ngModel)]="paciente.direccion" name="direccion" (input)="updateProgress()" required />
            <div *ngIf="showRequiredError && !paciente.direccion" class="error-message">*Campo requerido</div>
          </div>
        </div>
      </div>

      <!-- Historia Cl√≠nica -->
      <div class="section">
        <h3>Historia Cl√≠nica</h3>
        <div class="input-group">
          <div class="input-item">
            <label for="notasSesionAnterior">Notas de la Sesi√≥n Anterior</label>
            <textarea id="notasSesionAnterior" [(ngModel)]="paciente.notasSesionAnterior" name="notasSesionAnterior" (input)="updateProgress()"></textarea>
          </div>

          <div class="input-item">
            <label for="medicamentos">Medicamentos</label>
            <textarea id="medicamentos" [(ngModel)]="paciente.medicamentos" name="medicamentos" (input)="updateProgress()"></textarea>
          </div>
        </div>
      </div>

      <button type="submit" class="save-button" [disabled]="!isFormComplete()">Guardar Ficha</button>
    </form>

    <!-- Mensaje de √©xito al guardar -->
    <div *ngIf="showSuccessMessage" class="success-alert animate-success">
      <p>Ficha guardada correctamente ‚úîÔ∏è</p>
    </div>

    <!-- Confirmaci√≥n de cierre -->
    <div *ngIf="isConfirmingClose" class="confirmation-overlay">
      <div class="confirmation-dialog">
        <p>¬øEst√° seguro de que desea cerrar el formulario? Se perder√°n los datos no guardados.</p>
        <button class="confirm-button" (click)="confirmClose()">S√≠</button>
        <button class="cancel-button" (click)="cancelClose()">No</button>
      </div>
    </div>
  </div>
</div>
